<!DOCTYPE html>
<!-- This is depreciated. -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <title>CAIT Bell Schedule</title>
    <style>
      @font-face {font-family: "SegUI"; src: url("/SegUIVar.ttf");}
      body {font-family: "SegUI";}
    </style>
  </head>
  <body>
    <canvas id="canvas" width="346" height="60"></canvas>
    <script>
    class DayEvent{
      constructor(startHour, startMin, name, endHour, endMin){
        this.startHour = startHour;
        this.startMin = startMin;
        this.name = name;
        this.endHour = endHour;
        this.endMin = endMin;
      }
    }
    var LIGHTBLUE = "#1490DF";
    var GREEN = "#19c819";
    var RED = "#c81919";
    var WHITE = "#ffffff"
    var current_lunch = 1;

    var Monday1 = new Array(12);
    Monday1[0] = new DayEvent(1,0,"Morning",7,20);
    Monday1[1] = new DayEvent(7,20,"1st Period",8,13);
    Monday1[2] = new DayEvent(8,18,"2nd Period",9,10);
    Monday1[3] = new DayEvent(9,15,"3rd Period",10,5);
    Monday1[4] = new DayEvent(10,10,"4th Period",11,2);
    Monday1[5] = new DayEvent(11,2,"Lunch",11,32);
    Monday1[6] = new DayEvent(11,37,"5th Period",12,27);
    Monday1[7] = new DayEvent(12,32,"6th Period",13,24);
    Monday1[8] = new DayEvent(13,49,"7th Period",14,20);
    Monday1[9] = new DayEvent(14,20,"Dismissal",14,25);
    Monday1[10] = new DayEvent(14,25,"After School",23,59);
    Monday1[11] = new DayEvent(23,59,"End",23,59);

    var Monday2 = new Array(12);
    Monday2[0] = new DayEvent(1,0,"Morning",7,20);
    Monday2[1] = new DayEvent(7,20,"1st Period",8,13);
    Monday2[2] = new DayEvent(8,18,"2nd Period",9,10);
    Monday2[3] = new DayEvent(9,15,"3rd Period",10,5);
    Monday2[4] = new DayEvent(10,10,"4th Period",11,2);
    Monday2[5] = new DayEvent(11,7,"5th Period",11,57);
    Monday2[6] = new DayEvent(11,57,"Lunch",12,27);
    Monday2[7] = new DayEvent(12,32,"6th Period",13,24);
    Monday2[8] = new DayEvent(13,49,"7th Period",14,20);
    Monday2[9] = new DayEvent(14,20,"Dismissal",14,25);
    Monday2[10] = new DayEvent(14,25,"After School",23,59);
    Monday2[11] = new DayEvent(23,59,"End",23,59);



    var Wednesday1 = new Array(9);
    Wednesday1[0] = new DayEvent(1,0,"Morning",7,20);
    Wednesday1[1] = new DayEvent(7,20,"2nd Period",8,49);
    Wednesday1[2] = new DayEvent(8,55,"4th Period",10,21);
    Wednesday1[3] = new DayEvent(10,21,"Lunch",10,51);
    Wednesday1[4] = new DayEvent(10,57,"Homeroom",11,47);
    Wednesday1[5] = new DayEvent(11,53,"6th Period",13,20);
    Wednesday1[6] = new DayEvent(13,20,"Dismissal",13,25);
    Wednesday1[7] = new DayEvent(13,25,"After School",23,59);
    Wednesday1[8] = new DayEvent(23,59,"End",23,59);

    var Wednesday2 = new Array(11);
    Wednesday2[0] = new DayEvent(1,0,"Morning",7,20);
    Wednesday2[1] = new DayEvent(7,20,"2nd Period",8,49);
    Wednesday2[2] = new DayEvent(8,55,"4th Period",10,21);
    Wednesday2[3] = new DayEvent(10,27,"Homeroom",11,17);
    Wednesday2[4] = new DayEvent(11,17,"Lunch",11,47);
    Wednesday2[5] = new DayEvent(11,53,"6th Period",13,20);
    Wednesday2[6] = new DayEvent(13,20,"Dismissal",13,25);
    Wednesday2[7] = new DayEvent(13,25,"After School",23,59);
    Wednesday2[8] = new DayEvent(23,59,"End",23,59);



    var Thursday1 = new Array(14);
    Thursday1[0] = new DayEvent(1,0,"Morning",7,20);
    Thursday1[1] = new DayEvent(7,20,"1st Period",8,55);
    Thursday1[2] = new DayEvent(9,1,"3rd Period",10,33);
    Thursday1[3] = new DayEvent(10,33,"Lunch",11,3);
    Thursday1[4] = new DayEvent(11,9,"5th Period",12,41);
    Thursday1[5] = new DayEvent(12,47,"7th Period",14,20);
    Thursday1[6] = new DayEvent(14,20,"Dismissal",14,25);
    Thursday1[7] = new DayEvent(14,25,"After School",23,59);
    Thursday1[8] = new DayEvent(23,59,"End",23,59);

    var Thursday2 = new Array(15);
    Thursday2[0] = new DayEvent(1,0,"Morning",7,20);
    Thursday2[1] = new DayEvent(7,20,"1st Period",8,55);
    Thursday2[2] = new DayEvent(9,1,"3rd Period",10,33);
    Thursday2[3] = new DayEvent(10,39,"5th Period",12,11);
    Thursday2[4] = new DayEvent(12,11,"5th Period",12,41);
    Thursday2[5] = new DayEvent(12,47,"7th Period",14,20);
    Thursday2[6] = new DayEvent(14,20,"Dismissal",14,25);
    Thursday2[7] = new DayEvent(14,25,"After School",23,59);
    Thursday2[8] = new DayEvent(23,59,"End",23,59);

    var Activity1 = new Array(13);
    Activity1[0] = new DayEvent(1,0,"Morning",7,20);
    Activity1[1] = new DayEvent(7,20,"1st Period",8,5);
    Activity1[2] = new DayEvent(8,10,"2nd Period",8,50);
    Activity1[3] = new DayEvent(8,55,"3rd Period",9,35);
    Activity1[4] = new DayEvent(9,40,"4th Period",10,20);
    Activity1[5] = new DayEvent(10,20,"Lunch",10,50);
    Activity1[6] = new DayEvent(10,55,"5th Period",11,35);
    Activity1[7] = new DayEvent(11,40,"Homeroom",12,45);
    Activity1[8] = new DayEvent(12,50,"6th Period",13,30);
    Activity1[9] = new DayEvent(13,35,"7th Period",14,20);
    Activity1[10] = new DayEvent(14,20,"Dismissal",14,25);
    Activity1[11] = new DayEvent(14,25,"After School",23,59);
    Activity1[12] = new DayEvent(23,59,"End",23,59);

    var Activity2 = new Array(13);
    Activity2[0] = new DayEvent(1,0,"Morning",7,20);
    Activity2[1] = new DayEvent(7,20,"1st Period",8,5);
    Activity2[2] = new DayEvent(8,10,"2nd Period",8,50);
    Activity2[3] = new DayEvent(8,55,"3rd Period",9,35);
    Activity2[4] = new DayEvent(9,40,"4th Period",10,20);
    Activity2[5] = new DayEvent(10,25,"5th Period",11,5);
    Activity2[6] = new DayEvent(11,5,"Lunch",11,35);
    Activity2[7] = new DayEvent(11,40,"Homeroom",12,45);
    Activity2[8] = new DayEvent(12,50,"6th Period",13,30);
    Activity2[9] = new DayEvent(13,35,"7th Period",14,20);
    Activity2[10] = new DayEvent(14,20,"Dismissal",14,25);
    Activity2[11] = new DayEvent(14,25,"After School",23,59);
    Activity2[12] = new DayEvent(23,59,"End",23,59);

    var canvas = document.getElementById("canvas");
    elemLeft = canvas.offsetLeft,
    elemTop = canvas.offsetTop,
    ctx = canvas.getContext("2d"),
    elements = [];

    var eventNumber = 1;
    setInterval(mainLoop, 100);



    elements.push({
      lunch: 1,
      width: 60,
      height: 16,
      top: 2,
      left: 284
    });

    elements.push({
      lunch: 2,
      width: 60,
      height: 16,
      top: 20,
      left: 284
    });

    function mainLoop(){
      ctx.clearRect(0, 0, 346, 60);
      drawDateTime(ctx);
      let Periodmsg = "Loading...";
      let currentDay = Monday1;
      const now = new Date();
      const day = now.getDay();
      if(current_lunch === 1){
        if(day === 1){currentDay = Monday1; Periodmsg = "Today is a Normal Day.";}
        else if(day === 2){currentDay = Monday1; Periodmsg = "Today is a Normal Day.";}
        else if(day === 3){currentDay = Wednesday1; Periodmsg = "Today is an EVEN Block Day.";}
        else if(day === 4){currentDay = Thursday1; Periodmsg = "Today is an ODD Block Day.";}
        else if(day === 5){currentDay = Monday1; Periodmsg = "Today is an Normal Day.";}
      } else if(current_lunch === 2){
        if(day === 1){currentDay = Monday2; Periodmsg = "Today is a Normal Day.";}
        else if(day === 2){currentDay = Monday2; Periodmsg = "Today is a Normal Day.";}
        else if(day === 3){currentDay = Wednesday2; Periodmsg = "Today is an EVEN Block Day.";}
        else if(day === 4){currentDay = Thursday2; Periodmsg = "Today is an ODD Block Day.";}
        else if(day === 5){currentDay = Monday2; Periodmsg = "Today is an Normal Day.";}
      } else{current_lunch=1}

      var currentEvent = currentDay[eventNumber-1];
      drawPeriodMsg(ctx, Periodmsg);
      drawEventCountDown(ctx, currentEvent);
      var event_sec = hms2sec(currentEvent.endHour, currentEvent.endMin, 0);
      var now_sec = hms2sec(now.getHours(), now.getMinutes(), now.getSeconds());
      if (eventNumber >= currentDay.length){
        eventNumber = 0;
      }
      if (event_sec - now_sec < 0){
        eventNumber ++;
      }
      if (current_lunch == 1){drawButton(ctx, GREEN, 284, 2, 60, 16);}
      else{drawButton(ctx, LIGHTBLUE, 284, 2, 60, 16);}
      buttonText(ctx, "A Lunch", 292.5, 14);
      if (current_lunch == 2){drawButton(ctx, GREEN, 284, 20, 60, 16);}
      else{drawButton(ctx, LIGHTBLUE, 284, 20, 60, 16);}
      buttonText(ctx, "B Lunch", 293, 32);

      // Add event listener for `click` events.
      canvas.addEventListener('click', function(event) {
        var x = event.pageX - elemLeft,
          y = event.pageY - elemTop;
        console.log(x, y);
        elements.forEach(function(element) {
          if (y > element.top && y < element.top + element.height && x > element.left && x < element.left + element.width) {
            current_lunch = element.lunch;
            eventNumber = 1;
            currentEvent = currentDay[eventNumber];
          }
        });

      }, false);
    }
    function drawButton(ctx, color, xpos, ypos, width, height){
      ctx.fillStyle = color;
      ctx.fillRect(xpos, ypos, width, height);
    }
    function buttonText(ctx, text, xpos, ypos){
      ctx.font = "12px SegUI";
      ctx.fillStyle = "white";
      ctx.fillText(text, xpos, ypos);
    }
    function hms2sec(hours, minutes, seconds){
      var sec = (hours * 3600) + (minutes*60) + seconds;
      return sec;
    }
    function sec2hms(sec){
      var remaining = sec;
      var hms = "";
      var hours = Math.floor(sec/3600);
      remaining -= hours * 3600;
      var minutes = Math.floor(remaining/60);
      remaining -= minutes * 60;
      if (sec >= 36000){
        hms = hours.toString() + ":";
      }
      else {
        hms = "0" + hours.toString() + ":";
      }
      if (minutes >= 10){
        hms += minutes.toString();
      }
      else{
        hms += "0" + minutes.toString();
      }
      return hms;

    }
    function difTime(currentEvent){
      var now = new Date();
      var event_sec = hms2sec(currentEvent.endHour, currentEvent.endMin, 0);
      var now_sec = hms2sec(now.getHours(), now.getMinutes(), now.getSeconds());
      var remaining = sec2hms(event_sec - now_sec);
      return remaining;
    }
    function drawDateTime(ctx){
      var now = new Date();
      var day = now.getDay();
      var weekday = new Array(7);
      weekday[0] = "Sunday";
      weekday[1] = "Monday";
      weekday[2] = "Tuesday";
      weekday[3] = "Wednesday";
      weekday[4] = "Thursday";
      weekday[5] = "Friday";
      weekday[6] = "Saturday";
      var dayname = weekday[day];
      var month = now.getMonth() + 1
      var date = now.getDate()
      var year = now.getFullYear()
      var time12h = now.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })
      var dateString = dayname + "  " + month + "/" + date + "/" + year + "  " + time12h
      ctx.font = "18px SegUI";
      ctx.fillStyle = "black";
      ctx.fillText(dateString, 0, 16);
    }
    function drawPeriodMsg(ctx, Periodmsg){
      ctx.font = "18px SegUI";
      ctx.fillStyle = "black";
      ctx.fillText(Periodmsg, 0, 36);
    }
    function drawEventCountDown(ctx, currentEvent){
      ctx.fillStyle = "black";
      var now = new Date();
      var EventName = currentEvent.name;
      var hours = currentEvent.endHour-now.getHours();
      var minutes = currentEvent.endMin-now.getMinutes()-1;
      var seconds = 60-now.getSeconds();
      var remaining = (hours*3600) + (minutes * 60) + seconds;
      ctx.font = "18px SegUI";
      if (hours < 10){
        hours = "0"+hours;
      }
      if (minutes < 10){
        minutes = "0"+minutes;
      }
      var event_sec = hms2sec(currentEvent.endHour, currentEvent.endMin, 0);
      var now_sec = hms2sec(now.getHours(), now.getMinutes(), now.getSeconds());
      var count_down = sec2hms(event_sec - now_sec);
      if (event_sec - now_sec <= 600){ctx.fillStyle = "red";}
      if (event_sec - now_sec <= 60 && now_sec % 2 == 1){ctx.fillStyle = "white";}
      if (count_down == "00:00"){count_down = "< 1 min";}
      ctx.fillText(EventName + ", Time Left: " + count_down.toString() , 0, 56);

    }
    </script>
  </body>
</html>